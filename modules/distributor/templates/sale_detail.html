{% extends "distributor_base.html" %}

{% block title %}Sale Detail #{{ sale[0] }} — Golden Bee{% endblock %}
{% block breadcrumb %}Sales / Detail{% endblock %}
{% block page_title %}Sale Detail{% endblock %}

{% block extra_css %}
<style>
  :root {
    --gold: #FDB022; --gold-light: #FFF3CD; --gold-dark: #E69A0E;
    --green: #10B981; --green-light: #D1FAE5;
    --red: #EF4444; --red-light: #FEE2E2;
    --amber: #F59E0B; --amber-light: #FEF3C7;
    --blue: #3B82F6; --blue-light: #DBEAFE;
    --radius: 12px;
    --shadow-sm: 0 1px 3px rgba(0,0,0,.08);
    --shadow-md: 0 4px 12px rgba(0,0,0,.10);
  }

  .detail-grid {
    display: grid;
    grid-template-columns: 1fr 340px;
    gap: 24px;
    align-items: start;
  }

  .detail-card {
    background: #fff;
    border-radius: var(--radius);
    box-shadow: var(--shadow-sm);
    overflow: hidden;
  }
  .detail-card-header {
    padding: 20px 24px;
    border-bottom: 1px solid #E5E7EB;
    display: flex; align-items: center; justify-content: space-between;
  }
  .detail-card-title { font-size: 15px; font-weight: 700; color: #111827; }
  .detail-card-body  { padding: 24px; }

  /* ── Top Hero ── */
  .sale-hero {
    background: linear-gradient(135deg, #1F2937 0%, #374151 100%);
    border-radius: var(--radius);
    padding: 32px;
    color: #fff;
    margin-bottom: 24px;
    position: relative;
    overflow: hidden;
  }
  .sale-hero::after {
    content: '\f571';
    font-family: 'Font Awesome 6 Free'; font-weight: 900;
    position: absolute; right: -10px; bottom: -20px;
    font-size: 140px; opacity: .04; color: #fff;
  }
  .sale-hero-top { display: flex; justify-content: space-between; align-items: flex-start; flex-wrap: wrap; gap: 16px; }
  .sale-id-badge {
    background: rgba(253,176,34,.15);
    border: 1px solid rgba(253,176,34,.3);
    color: var(--gold);
    padding: 6px 14px; border-radius: 20px; font-size: 13px; font-weight: 700;
  }
  .sale-amount {
    font-size: 42px; font-weight: 800;
    color: var(--gold); margin: 16px 0 4px; line-height: 1;
  }
  .sale-product-name { font-size: 18px; font-weight: 600; color: #fff; }
  .sale-meta { font-size: 13px; color: #9CA3AF; margin-top: 4px; }

  .status-badge {
    display: inline-flex; align-items: center; gap: 6px;
    padding: 8px 16px; border-radius: 20px; font-size: 13px; font-weight: 700;
  }
  .status-badge.completed { background: rgba(16,185,129,.15); color: var(--green); border: 1px solid rgba(16,185,129,.3); }
  .status-badge.pending   { background: rgba(245,158,11,.15); color: var(--amber); border: 1px solid rgba(245,158,11,.3); }
  .status-badge.cancelled { background: rgba(239,68,68,.15);  color: var(--red);   border: 1px solid rgba(239,68,68,.3); }
  .status-badge::before { content: ''; width: 8px; height: 8px; border-radius: 50%; background: currentColor; }

  /* ── Detail Row ── */
  .detail-section { margin-bottom: 8px; }
  .detail-section-title {
    font-size: 11px; font-weight: 700; text-transform: uppercase;
    letter-spacing: .06em; color: #9CA3AF; margin-bottom: 12px;
    display: flex; align-items: center; gap: 8px;
  }
  .detail-section-title::after { content: ''; flex: 1; height: 1px; background: #F3F4F6; }

  .detail-row {
    display: flex; justify-content: space-between; align-items: center;
    padding: 12px 0; border-bottom: 1px solid #F9FAFB;
  }
  .detail-row:last-child { border-bottom: none; }
  .detail-key   { font-size: 13px; color: #6B7280; display: flex; align-items: center; gap: 8px; }
  .detail-key i { width: 16px; text-align: center; color: #D1D5DB; }
  .detail-val   { font-size: 14px; font-weight: 600; color: #111827; text-align: right; }

  /* ── Metrics ── */
  .metrics-grid {
    display: grid; grid-template-columns: 1fr 1fr;
    gap: 12px; margin-bottom: 0;
  }
  .metric-box {
    background: #F9FAFB; border-radius: 10px; padding: 16px; text-align: center;
    border: 1.5px solid #F3F4F6;
  }
  .metric-val { font-size: 22px; font-weight: 800; color: #111827; }
  .metric-lbl { font-size: 11px; color: #6B7280; margin-top: 4px; font-weight: 500; }

  /* ── Sticky Sidebar ── */
  .side-card { background: #fff; border-radius: var(--radius); box-shadow: var(--shadow-sm); margin-bottom: 16px; overflow: hidden; }
  .side-card-header { padding: 14px 18px; background: #F9FAFB; border-bottom: 1px solid #E5E7EB; font-size: 13px; font-weight: 700; color: #111827; }
  .side-card-body   { padding: 16px 18px; }
  .side-row { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #F9FAFB; font-size: 13px; }
  .side-row:last-child { border-bottom: none; }
  .side-key { color: #6B7280; }
  .side-val { font-weight: 600; color: #111827; }

  /* ── Action Buttons ── */
  .btn { display: inline-flex; align-items: center; gap: 8px; padding: 0 18px; height: 42px; border-radius: 8px; border: none; cursor: pointer; font-size: 13px; font-weight: 600; text-decoration: none; transition: all .2s; }
  .btn-primary { background: var(--gold); color: #1F2937; }
  .btn-primary:hover { background: var(--gold-dark); }
  .btn-outline { background: #fff; color: #6B7280; border: 1.5px solid #E5E7EB; }
  .btn-outline:hover { background: #F9FAFB; }
  .btn-danger  { background: var(--red-light); color: var(--red); }
  .btn-danger:hover  { background: var(--red); color: #fff; }
  .btn-full { width: 100%; justify-content: center; margin-bottom: 10px; }

  /* ── Notes ── */
  .notes-box {
    background: #FFFBEB; border: 1.5px solid #FDE68A;
    border-radius: 10px; padding: 14px;
    font-size: 13px; color: #78350F; line-height: 1.6;
    font-style: italic;
  }
  .empty-notes { color: #9CA3AF; font-style: italic; font-size: 13px; }

  /* ── Print ── */
  @media print {
    .no-print { display: none !important; }
    body { background: #fff; }
    .main-content { margin-left: 0 !important; }
    .topbar { display: none !important; }
    .detail-grid { grid-template-columns: 1fr; }
  }

  @media (max-width: 900px) {
    .detail-grid { grid-template-columns: 1fr; }
    .sale-amount { font-size: 32px; }
  }
</style>
{% endblock %}

{% block content %}
<!-- Nav -->
<div style="margin-bottom:20px; display:flex; gap:10px;" class="no-print">
  <a href="{{ url_for('distributor_sell_bp.manage_sales') }}" class="btn btn-outline" style="height:36px; padding:0 14px; font-size:13px;">
    <i class="fas fa-arrow-left"></i> Back
  </a>
  <button onclick="window.print()" class="btn btn-outline" style="height:36px; padding:0 14px; font-size:13px;">
    <i class="fas fa-print"></i> Print
  </button>
</div>

<!-- Hero Banner -->
<div class="sale-hero">
  <div class="sale-hero-top">
    <div class="sale-id-badge"><i class="fas fa-hashtag"></i> Sale #{{ sale[0] }}</div>
    <span class="status-badge {{ sale[8] }}">{{ sale[8]|capitalize }}</span>
  </div>
  <div class="sale-amount">LKR {{ "{:,.2f}".format(sale[4]) }}</div>
  <div class="sale-product-name">{{ sale[1] }}</div>
  <div class="sale-meta">
    <i class="fas fa-calendar-alt"></i>
    {{ sale[7].strftime('%A, %d %B %Y at %I:%M %p') if sale[7] else '—' }}
  </div>
</div>

<div class="detail-grid">

  <!-- Left Main -->
  <div>

    <!-- Product Details -->
    <div class="detail-card" style="margin-bottom:20px;">
      <div class="detail-card-header">
        <div class="detail-card-title"><i class="fas fa-box" style="color:var(--gold); margin-right:8px;"></i>Product Details</div>
      </div>
      <div class="detail-card-body">
        <div class="detail-section-title"><i class="fas fa-tag"></i> Product Information</div>
        <div class="detail-row">
          <span class="detail-key"><i class="fas fa-cube"></i> Product Name</span>
          <span class="detail-val">{{ sale[1] }}</span>
        </div>
        <div class="detail-row">
          <span class="detail-key"><i class="fas fa-layer-group"></i> Category</span>
          <span class="detail-val">{{ sale[11] or '—' }}</span>
        </div>
        <div class="detail-row">
          <span class="detail-key"><i class="fas fa-ruler"></i> Variant / Size</span>
          <span class="detail-val">{{ sale[10] or '—' }}</span>
        </div>
        <div class="detail-row">
          <span class="detail-key"><i class="fas fa-hourglass-half"></i> Shelf Life</span>
          <span class="detail-val">{{ sale[12] }} days</span>
        </div>

        <div class="detail-section-title" style="margin-top:20px;"><i class="fas fa-calculator"></i> Sale Breakdown</div>
        <div class="metrics-grid" style="margin-bottom:16px;">
          <div class="metric-box">
            <div class="metric-val">{{ sale[2] }}</div>
            <div class="metric-lbl">Units Sold</div>
          </div>
          <div class="metric-box">
            <div class="metric-val">LKR {{ "{:,.2f}".format(sale[3]) }}</div>
            <div class="metric-lbl">Unit Price</div>
          </div>
        </div>
        <div class="detail-row" style="background:#F0FDF4; padding:14px; border-radius:10px; border:1.5px solid #D1FAE5;">
          <span class="detail-key" style="color:var(--green); font-weight:700; font-size:15px;"><i class="fas fa-coins"></i> Total Amount</span>
          <span class="detail-val" style="font-size:22px; color:var(--green);">LKR {{ "{:,.2f}".format(sale[4]) }}</span>
        </div>
      </div>
    </div>

    <!-- Customer Details -->
    <div class="detail-card" style="margin-bottom:20px;">
      <div class="detail-card-header">
        <div class="detail-card-title"><i class="fas fa-user" style="color:var(--gold); margin-right:8px;"></i>Customer Information</div>
      </div>
      <div class="detail-card-body">
        {% if sale[5] or sale[6] %}
        <div class="detail-row">
          <span class="detail-key"><i class="fas fa-user"></i> Customer Name</span>
          <span class="detail-val">{{ sale[5] or '—' }}</span>
        </div>
        <div class="detail-row">
          <span class="detail-key"><i class="fas fa-phone"></i> Contact</span>
          <span class="detail-val">{{ sale[6] or '—' }}</span>
        </div>
        {% else %}
        <p style="color:#9CA3AF; font-size:13px; font-style:italic;">No customer information recorded.</p>
        {% endif %}
      </div>
    </div>

    <!-- Notes -->
    <div class="detail-card">
      <div class="detail-card-header">
        <div class="detail-card-title"><i class="fas fa-sticky-note" style="color:var(--gold); margin-right:8px;"></i>Notes</div>
      </div>
      <div class="detail-card-body">
        {% if sale[9] %}
        <div class="notes-box">{{ sale[9] }}</div>
        {% else %}
        <p class="empty-notes">No notes recorded for this sale.</p>
        {% endif %}
      </div>
    </div>

  </div>

  <!-- Right Sidebar -->
  <div style="position:sticky; top:20px;">
    <!-- Actions -->
    <div class="side-card no-print">
      <div class="side-card-header"><i class="fas fa-cog"></i> Actions</div>
      <div class="side-card-body">
        <a href="{{ url_for('distributor_sell_bp.update_sale', sale_id=sale[0]) }}"
           class="btn btn-primary btn-full">
          <i class="fas fa-edit"></i> Edit This Sale
        </a>
        <button class="btn btn-danger btn-full" onclick="document.getElementById('deleteModal').classList.add('active')">
          <i class="fas fa-trash"></i> Delete Sale
        </button>
        <a href="{{ url_for('distributor_sell_bp.manage_sales') }}"
           class="btn btn-outline btn-full">
          <i class="fas fa-list"></i> All Sales
        </a>
      </div>
    </div>

    <!-- Quick Info -->
    <div class="side-card">
      <div class="side-card-header"><i class="fas fa-info-circle"></i> Sale Information</div>
      <div class="side-card-body">
        <div class="side-row">
          <span class="side-key">Sale ID</span>
          <span class="side-val">#{{ sale[0] }}</span>
        </div>
        <div class="side-row">
          <span class="side-key">Status</span>
          <span class="side-val"><span class="status-badge {{ sale[8] }}" style="font-size:11px; padding:4px 10px;">{{ sale[8]|capitalize }}</span></span>
        </div>
        <div class="side-row">
          <span class="side-key">Date</span>
          <span class="side-val">{{ sale[7].strftime('%d %b %Y') if sale[7] else '—' }}</span>
        </div>
        <div class="side-row">
          <span class="side-key">Time</span>
          <span class="side-val">{{ sale[7].strftime('%I:%M %p') if sale[7] else '—' }}</span>
        </div>
        <div class="side-row">
          <span class="side-key">Stock ID</span>
          <span class="side-val">#{{ sale[13] }}</span>
        </div>
      </div>
    </div>
  </div>

</div>

<!-- Delete Modal -->
<div class="modal-overlay" id="deleteModal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,.5); z-index:2000; align-items:center; justify-content:center;">
  <div style="background:#fff; border-radius:16px; padding:32px; max-width:420px; width:90%; text-align:center; box-shadow:0 8px 24px rgba(0,0,0,.15);">
    <i class="fas fa-exclamation-triangle" style="font-size:48px; color:var(--red); margin-bottom:16px;"></i>
    <h3 style="font-size:18px; font-weight:700; margin-bottom:8px;">Delete This Sale?</h3>
    <p style="color:#6B7280; font-size:14px; margin-bottom:24px;">
      This will permanently delete Sale #{{ sale[0] }} and restore <strong>{{ sale[2] }} units</strong> to your stock. This cannot be undone.
    </p>
    <div style="display:flex; gap:12px; justify-content:center;">
      <button class="btn btn-outline" onclick="document.getElementById('deleteModal').style.display='none'">Cancel</button>
      <form method="POST" action="{{ url_for('distributor_sell_bp.delete_sale', sale_id=sale[0]) }}">
        <button type="submit" class="btn btn-danger">Delete Sale</button>
      </form>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.getElementById('deleteModal').addEventListener('click', function(e) {
  if (e.target === this) this.style.display = 'none';
});
// Fix display for modal (use flex when shown)
document.querySelectorAll('[onclick*="deleteModal"]').forEach(btn => {
  btn.addEventListener('click', () => {
    document.getElementById('deleteModal').style.display = 'flex';
  });
});
</script>
{% endblock %}