{% extends "distributor_base.html" %}

{% block title %}My Stock - Golden Bee{% endblock %}
{% block page_title %}My Stock Inventory{% endblock %}
{% block breadcrumb %}Inventory / My Stock{% endblock %}

{% block extra_css %}
<style>
    /* Stats Cards */
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }

    .stat-card {
        background: white;
        padding: 24px;
        border-radius: 12px;
        border: 1px solid #E5E7EB;
        display: flex;
        align-items: center;
        gap: 16px;
        transition: all 0.3s ease;
    }

    .stat-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 8px 24px rgba(0,0,0,0.12);
    }

    .stat-icon {
        width: 60px;
        height: 60px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 28px;
    }

    .stat-icon.products {
        background: linear-gradient(135deg, #FDB022, #FFD54F);
        color: #1F2937;
    }

    .stat-icon.quantity {
        background: linear-gradient(135deg, #3B82F6, #60A5FA);
        color: white;
    }

    .stat-icon.value {
        background: linear-gradient(135deg, #10B981, #34D399);
        color: white;
    }

    .stat-icon.low {
        background: linear-gradient(135deg, #EF4444, #F87171);
        color: white;
    }

    .stat-content h3 {
        font-size: 14px;
        color: #6B7280;
        margin: 0 0 8px 0;
        font-weight: 500;
    }

    .stat-content .value {
        font-size: 32px;
        font-weight: 700;
        color: #111827;
        line-height: 1;
    }

    /* Table Styles */
    .table-container {
        background: white;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }

    .table-header {
        padding: 20px 24px;
        border-bottom: 1px solid #E5E7EB;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .table-header h2 {
        font-size: 18px;
        font-weight: 600;
        color: #111827;
        margin: 0;
    }

    .search-box {
        position: relative;
        width: 300px;
    }

    .search-box i {
        position: absolute;
        left: 12px;
        top: 50%;
        transform: translateY(-50%);
        color: #6B7280;
        font-size: 14px;
    }

    .search-box input {
        width: 100%;
        padding: 10px 12px 10px 38px;
        border: 1px solid #E5E7EB;
        border-radius: 8px;
        font-size: 14px;
        font-family: inherit;
        transition: all 0.2s ease;
    }

    .search-box input:focus {
        outline: none;
        border-color: #FDB022;
        box-shadow: 0 0 0 3px rgba(253, 176, 34, 0.1);
    }

    .search-box input::placeholder {
        color: #9CA3AF;
    }

    table {
        width: 100%;
        border-collapse: collapse;
    }

    thead {
        background: #F9FAFB;
    }

    th {
        padding: 12px 24px;
        text-align: left;
        font-size: 12px;
        font-weight: 600;
        color: #6B7280;
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }

    tbody tr {
        border-bottom: 1px solid #F3F4F6;
        transition: background 0.2s;
    }

    tbody tr:hover {
        background: #F9FAFB;
    }

    td {
        padding: 16px 24px;
        font-size: 14px;
        color: #111827;
    }

    .product-cell {
        display: flex;
        align-items: center;
        gap: 12px;
    }

    .product-image {
        width: 50px;
        height: 50px;
        border-radius: 8px;
        object-fit: cover;
    }

    .product-info {
        flex: 1;
    }

    .product-name {
        font-weight: 600;
        color: #111827;
        margin: 0 0 4px 0;
    }

    .product-variant {
        font-size: 12px;
        color: #6B7280;
    }

    .qty-badge {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 6px 12px;
        border-radius: 6px;
        font-weight: 600;
        font-size: 14px;
    }

    .qty-good {
        background: #D1FAE5;
        color: #065F46;
    }

    .qty-low {
        background: #FEE2E2;
        color: #991B1B;
    }

    .qty-out {
        background: #F3F4F6;
        color: #6B7280;
    }

    .price-cell {
        font-weight: 600;
        color: #10B981;
    }

    .value-cell {
        font-weight: 700;
        color: #111827;
    }

    .empty-state {
        text-align: center;
        padding: 60px 20px;
    }

    .empty-icon {
        font-size: 64px;
        color: #D1D5DB;
        margin-bottom: 16px;
    }

    .empty-title {
        font-size: 20px;
        font-weight: 600;
        color: #374151;
        margin-bottom: 8px;
    }

    .empty-text {
        color: #6B7280;
    }

    @media (max-width: 768px) {
        .stats-grid {
            grid-template-columns: 1fr;
        }
        
        .table-header {
            flex-direction: column;
            align-items: stretch;
            gap: 12px;
        }
        
        .search-box {
            width: 100%;
        }
        
        table {
            font-size: 12px;
        }
        
        td, th {
            padding: 12px;
        }
    }
</style>
{% endblock %}

{% block content %}
<!-- Stats Cards -->
<div class="stats-grid">
    <div class="stat-card">
        <div class="stat-icon products">
            <i class="fas fa-box"></i>
        </div>
        <div class="stat-content">
            <h3>Total Products</h3>
            <div class="value">{{ stats.total_products }}</div>
        </div>
    </div>
    
    <div class="stat-card">
        <div class="stat-icon quantity">
            <i class="fas fa-cubes"></i>
        </div>
        <div class="stat-content">
            <h3>Total Units</h3>
            <div class="value">{{ stats.total_quantity }}</div>
        </div>
    </div>
    
    <div class="stat-card">
        <div class="stat-icon value">
            <i class="fas fa-dollar-sign"></i>
        </div>
        <div class="stat-content">
            <h3>Total Value</h3>
            <div class="value">Rs. {{ "%.2f"|format(stats.total_value) }}</div>
        </div>
    </div>
    
    <div class="stat-card">
        <div class="stat-icon low">
            <i class="fas fa-exclamation-triangle"></i>
        </div>
        <div class="stat-content">
            <h3>Low Stock Items</h3>
            <div class="value">{{ stats.low_stock_count }}</div>
        </div>
    </div>
</div>

<!-- Stock Table -->
<div class="table-container">
    <div class="table-header">
        <h2><i class="fas fa-warehouse"></i> My Inventory</h2>
        <div class="search-box">
            <i class="fas fa-search"></i>
            <input type="text" id="searchInput" placeholder="Search products..." onkeyup="searchTable()">
        </div>
    </div>
    
    {% if stock_items %}
    <table>
        <thead>
            <tr>
                <th>Product</th>
                <th>Category</th>
                <th>Quantity</th>
                <th>Unit Price</th>
                <th>Total Value</th>
                <th>Last Updated</th>
            </tr>
        </thead>
        <tbody>
            {% for item in stock_items %}
            <tr>
                <td>
                    <div class="product-cell">
                        <div class="product-info">
                            <div class="product-name">{{ item.product_name }}</div>
                            {% if item.variant_size %}
                            <div class="product-variant">{{ item.variant_size }}</div>
                            {% endif %}
                        </div>
                    </div>
                </td>
                <td>
                    <span style="display: inline-flex; align-items: center; gap: 6px; padding: 4px 12px; background: #F3F4F6; border-radius: 6px; font-size: 13px; color: #374151;">
                        <i class="fas fa-tag" style="color: #6B7280;"></i>
                        {{ item.category_name }}
                    </span>
                </td>
                <td>
                    {% if item.quantity == 0 %}
                    <span class="qty-badge qty-out">
                        <i class="fas fa-times-circle"></i>
                        Out of Stock
                    </span>
                    {% elif item.quantity < 10 %}
                    <span class="qty-badge qty-low">
                        <i class="fas fa-exclamation-triangle"></i>
                        {{ item.quantity }}
                    </span>
                    {% else %}
                    <span class="qty-badge qty-good">
                        <i class="fas fa-check-circle"></i>
                        {{ item.quantity }}
                    </span>
                    {% endif %}
                </td>
                <td class="price-cell">Rs. {{ "%.2f"|format(item.unit_price) }}</td>
                <td class="value-cell">Rs. {{ "%.2f"|format(item.total_value) }}</td>
                <td style="color: #6B7280;">{{ item.formatted_date }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <div class="empty-state">
        <div class="empty-icon">
            <i class="fas fa-box-open"></i>
        </div>
        <div class="empty-title">No Stock Yet</div>
        <div class="empty-text">
            Your inventory is empty. Place orders to receive stock from admin.
        </div>
    </div>
    {% endif %}
</div>

<script>
function searchTable() {
    const input = document.getElementById('searchInput');
    const filter = input.value.toUpperCase();
    const table = document.querySelector('table');
    const tbody = table ? table.querySelector('tbody') : null;
    
    if (!tbody) return;
    
    const rows = tbody.getElementsByTagName('tr');
    let visibleCount = 0;
    
    for (let i = 0; i < rows.length; i++) {
        const row = rows[i];
        
        // Get all text content from the row
        const rowText = row.textContent || row.innerText;
        
        if (rowText.toUpperCase().indexOf(filter) > -1) {
            row.style.display = '';
            visibleCount++;
        } else {
            row.style.display = 'none';
        }
    }
    
    // Handle empty results
    const tableWrapper = table.parentElement;
    let noResultsMsg = document.getElementById('noResultsMessage');
    
    if (visibleCount === 0 && filter !== '') {
        // Hide table
        table.style.display = 'none';
        
        // Show no results message
        if (!noResultsMsg) {
            noResultsMsg = document.createElement('div');
            noResultsMsg.id = 'noResultsMessage';
            noResultsMsg.className = 'empty-state';
            noResultsMsg.innerHTML = `
                <div class="empty-icon"><i class="fas fa-search"></i></div>
                <div class="empty-title">No Results Found</div>
                <div class="empty-text">No products match "${input.value}"</div>
            `;
            tableWrapper.appendChild(noResultsMsg);
        }
    } else {
        // Show table
        table.style.display = 'table';
        
        // Remove no results message
        if (noResultsMsg) {
            noResultsMsg.remove();
        }
    }
}

// Clear search on page load
document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('searchInput');
    if (searchInput) {
        searchInput.value = '';
    }
});
</script>
{% endblock %}